<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Social preview thumbnail -->
  <meta property="og:title" content="CGS Tech Document Hub">
  <meta property="og:description" content="Browse, preview, and download our PDF resources">
  <meta property="og:image" content="https://cgs-engine.github.io/info/assets/thumbnail.png">
  <meta property="og:type" content="website">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="CGS Tech Document Hub">
  <meta name="twitter:description" content="Browse, preview, and download our PDF resources">
  <meta name="twitter:image" content="https://cgs-engine.github.io/info/assets/thumbnail.png">

  <title>CGS Tech Document Hub</title>

  <style>
    :root{
      --bg:#083355;
      --text:#e7e8ea; --muted:#a7acb8;
      --card:#0f1828; --border:#1f2a44;
      --btn-border:#8fb8ff; --frame:#faf6eb;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}

    /* Header */
    header{text-align:center;margin:10px 0 18px}
    .brand{display:flex;align-items:center;justify-content:center;gap:10px}
    .logo{width:40px;height:40px;border-radius:9px;background:radial-gradient(120% 120% at 20% 20%, #8df, #6aa5ff 40%, #2a3450 70%, #0e1422 100%);box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0;font-weight:800;letter-spacing:.2px;font-size:22px}
    @media (min-width:761px){h1{font-size:34px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}}
    .subtitle{color:var(--muted);font-size:14px;margin-top:6px}

    /* Controls card */
    .panel{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px}
    .docs{display:flex;gap:8px;overflow-x:auto;padding:2px 2px 8px;scroll-snap-type:x mandatory}
    .docs::-webkit-scrollbar{height:8px}.docs::-webkit-scrollbar-thumb{background:#22324d;border-radius:8px}
    .doc-btn{
      scroll-snap-align:start;border:1px solid var(--btn-border);
      background:linear-gradient(145deg,#1b273d,#0f1828);color:var(--text);
      padding:10px 14px;border-radius:10px;font-weight:600;white-space:nowrap;cursor:pointer;
      transition:transform .1s ease,border-color .2s ease,background .2s ease;
      box-shadow:inset -2px -2px 0 rgba(255,255,255,.06), inset 2px 2px 0 rgba(0,0,0,.45)
    }
    .doc-btn:hover{background:linear-gradient(145deg,#22324d,#152036);border-color:#bcd6ff}

    /* Action buttons */
    .actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      border:1px solid var(--btn-border);
      background:linear-gradient(145deg,#1b273d,#0f1828);
      color:var(--text);text-decoration:none;
      padding:10px 12px;border-radius:10px;font-weight:600;font-size:14px;
      box-shadow:inset -2px -2px 0 rgba(255,255,255,.06), inset 2px 2px 0 rgba(0,0,0,.45)
    }
    .btn:hover{background:linear-gradient(145deg,#22324d,#152036);border-color:#bcd6ff}

    /* Desktop embedded PDF */
    .viewer{display:none;margin-top:16px;background:var(--frame);border-radius:14px;padding:10px}
    .viewer iframe{width:100%;height:78vh;border:0;border-radius:8px;background:var(--frame)}
    .viewer-fallback{background:rgba(0,0,0,.25);color:#fff;padding:10px;border-radius:8px;margin-bottom:8px;font-size:14px}

    /* Mobile multipage preview */
    .mobile-preview{display:block;margin-top:16px;background:var(--frame);border-radius:14px;padding:8px;max-height:85svh;overflow:auto;-webkit-overflow-scrolling:touch}
    .quality{display:flex;justify-content:flex-end;align-items:center;margin:2px 2px 8px;color:#2c2a24;font-size:12px}
    .quality input{margin-right:6px;accent-color:#1f5ad4}
    #previewPages{display:flex;flex-direction:column;gap:8px}
    .page-canvas{display:block;width:100%;height:auto;border-radius:8px;background:var(--frame);image-rendering:crisp-edges;image-rendering:-webkit-optimize-contrast}
    .preview-note{color:#362f1d;font-size:12px;margin:6px 4px 0}

    /* Footer */
    footer{text-align:center;color:var(--muted);font-size:12px;margin:18px 0 20px}

    /* Desktop/tablet layout tweaks */
    @media (min-width:761px){
      .wrap{padding:24px}
      .panel{display:flex;align-items:center;gap:14px;padding:14px 16px}
      .docs{flex:1;overflow-x:visible;flex-wrap:wrap;padding:0;gap:10px}
      .doc-btn{padding:12px 16px;border-radius:12px}
      .actions{grid-template-columns:auto auto;gap:10px}
      .viewer{display:block}
      .mobile-preview{display:none}
    }
  </style>
  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    if (window['pdfjsLib']) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
  </script>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>CGS Tech Document Hub</h1>
      </div>
      <div class="subtitle">Browse, preview, and download our PDF resources</div>
    </header>

    <!-- Controls -->
    <section class="panel" aria-label="Choose a document">
      <div id="docList" class="docs"></div>
      <div class="actions">
        <a id="openFull" class="btn open-full" target="_blank" rel="noopener">üóî Open full-screen</a>
        <a id="downloadBtn" class="btn" download>‚¨áÔ∏è Download</a>
      </div>
    </section>

    <!-- Desktop embedded PDF -->
    <section class="viewer" aria-label="Preview (desktop)">
      <div id="viewerFallback" class="viewer-fallback" hidden>
        Preview not available in this browser. Use <strong>Open full-screen</strong> above.
      </div>
      <iframe id="pdfFrameDesktop" title="PDF preview" allow="fullscreen"></iframe>
    </section>

    <!-- Mobile multipage preview (PDF.js) -->
    <section class="mobile-preview" aria-label="Preview (mobile)">
      <div class="quality">
        <label for="hdToggle"><input type="checkbox" id="hdToggle"> HD (4√ó) preview</label>
      </div>
      <div id="previewPages"></div>
      <div class="preview-note">Swipe to browse pages. Tap <strong>Open full-screen</strong> for the native viewer on iPhone.</div>
    </section>
  </div>

  <footer>¬© 2025 CGS Tech. All rights reserved.</footer>

  <script>
    // 1) List your docs here
    const documents = [
      {name:'CGS Engine: Quant-AI, Reinvented', file:'docs/CGS_Tech_v0.pdf'}
    ];

    // 2) Elements
    const docList = document.getElementById('docList');
    const openFull = document.getElementById('openFull');
    const downloadBtn = document.getElementById('downloadBtn');
    const frameEl = document.getElementById('pdfFrameDesktop');
    const viewerFallback = document.getElementById('viewerFallback');
    const pagesContainer = document.getElementById('previewPages');
    const hdToggle = document.getElementById('hdToggle');

    // 3) Helpers
    const isMobile = () => window.matchMedia('(max-width: 760px)').matches;

    function cacheBustedUrl(file){
      const [path, hash] = file.split('#');
      const sep = path.includes('?') ? '&' : '?';
      const zoomHash = 'zoom=page-width&view=FitH';
      const h = hash ? (hash + '&' + zoomHash) : zoomHash;
      return `${path}${sep}v=${Date.now()}#${h}`;
    }

    // HiDPI lazy renderer for mobile
    let scaleCap = 3; // default; HD toggle sets to 4

    function setupLazyRenderer(pdf, cap){
      const options = { root: document.querySelector('.mobile-preview'), threshold: 0.1 };
      const io = new IntersectionObserver(async (entries) => {
        for (const entry of entries){
          if (!entry.isIntersecting) continue;
          const canvas = entry.target;
          if (canvas.dataset.rendered === 'true') continue;

          const pageIndex = parseInt(canvas.dataset.page, 10);
          const page = await pdf.getPage(pageIndex);

          const viewport1x = page.getViewport({ scale: 1 });
          const cssWidth = canvas.parentElement.clientWidth;
          const baseScale = cssWidth / viewport1x.width;
          const dpr = Math.min(cap, window.devicePixelRatio || 1); // 3√ó or 4√ó
          const scaledViewport = page.getViewport({ scale: baseScale * dpr });

          canvas.width  = Math.floor(scaledViewport.width);
          canvas.height = Math.floor(scaledViewport.height);
          canvas.style.width  = Math.floor(scaledViewport.width  / dpr) + 'px';
          canvas.style.height = Math.floor(scaledViewport.height / dpr) + 'px';

          const ctx = canvas.getContext('2d', { alpha: false });
          ctx.imageSmoothingEnabled = false;

          await page.render({ canvasContext: ctx, viewport: scaledViewport, background: '#faf6eb' }).promise;
          canvas.dataset.rendered = 'true';
          io.unobserve(canvas);
        }
      }, options);
      return io;
    }

    async function renderMobilePreview(url){
      if (!window['pdfjsLib']) return;
      pagesContainer.innerHTML = '';
      const pdf = await pdfjsLib.getDocument(url).promise;
      const io = setupLazyRenderer(pdf, scaleCap);
      for (let p = 1; p <= pdf.numPages; p++){
        const c = document.createElement('canvas');
        c.className = 'page-canvas';
        c.dataset.page = String(p);
        c.dataset.rendered = 'false';
        pagesContainer.appendChild(c);
        io.observe(c);
      }
    }

    function applyDoc(doc){
      // Update links
      openFull.href = doc.file;
      downloadBtn.href = doc.file;
      downloadBtn.download = doc.file.split('/').pop();

      if (!isMobile()){
        // Desktop: load into iframe and show fallback if it fails to render
        viewerFallback.hidden = true;
        frameEl.removeAttribute('src');
        const url = cacheBustedUrl(doc.file);

        let loaded = false;
        const onLoad = () => {
          loaded = true;
          viewerFallback.hidden = true;
          frameEl.removeEventListener('load', onLoad);
        };
        frameEl.addEventListener('load', onLoad);

        frameEl.src = url;

        // If not loaded within 3s, show fallback note
        setTimeout(() => { if (!loaded) viewerFallback.hidden = false; }, 3000);
      } else {
        // Mobile: clear iframe and render multipage preview
        frameEl.removeAttribute('src');
        viewerFallback.hidden = true;
        renderMobilePreview(doc.file);
      }
    }

    // Build buttons and load the first doc
    documents.forEach((doc, i) =>{
      const b = document.createElement('button');
      b.className = 'doc-btn'; b.textContent = doc.name;
      b.addEventListener('click', () => applyDoc(doc));
      docList.appendChild(b);
      if (i===0) applyDoc(doc);
    });

    // HD toggle (mobile)
    if (hdToggle) {
      hdToggle.addEventListener('change', () => {
        scaleCap = hdToggle.checked ? 4 : 3;
        const current = documents.find(d => openFull.href.endsWith(d.file));
        if (current && isMobile()) renderMobilePreview(current.file);
      });
    }

    // Re-apply on resize/orientation
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        const current = documents.find(d => openFull.href.endsWith(d.file));
        if (!current) return;
        if (isMobile()) renderMobilePreview(current.file);
        else applyDoc(current);
      }, 150);
    });
  </script>
</body>
</html>
